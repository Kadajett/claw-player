// ─── Pokemon Red Tileset Collision Data ──────────────────────────────────────
// Walkable tile IDs per tileset, extracted from pret/pokered:
// https://github.com/pret/pokered/blob/master/data/tilesets/collision_tile_ids.asm
//
// Each tileset has a list of tile IDs that the player can walk on.
// All other tile IDs in that tileset are solid (walls, trees, water, etc.).
//
// RAM addresses:
//   wCurMapTileset = 0xD367 (current map's tileset index)
//   wTileInFrontOfPlayer = 0xCFC6 (tile ID the player is facing)

export const ADDR_CUR_MAP_TILESET = 0xd367;
export const ADDR_TILE_IN_FRONT_OF_PLAYER = 0xcfc6;

// Tileset index → set of walkable tile IDs
const TILESET_COLLISION: ReadonlyMap<number, ReadonlySet<number>> = new Map([
	// 0: Overworld (towns, routes)
	[
		0,
		new Set([
			0x00, 0x10, 0x1b, 0x20, 0x21, 0x23, 0x2c, 0x2d, 0x2e, 0x30, 0x31, 0x33, 0x39, 0x3c, 0x3e, 0x52, 0x54, 0x58, 0x5b,
		]),
	],
	// 1: RedsHouse1 (Red's House 1F, Blue's House, most NPC houses)
	[1, new Set([0x01, 0x02, 0x03, 0x11, 0x12, 0x13, 0x14, 0x1c, 0x1a])],
	// 2: RedsHouse2 (Red's House 2F, upstairs rooms)
	[2, new Set([0x01, 0x02, 0x03, 0x11, 0x12, 0x13, 0x14, 0x1c, 0x1a])],
	// 3: Mart
	[3, new Set([0x11, 0x1a, 0x1c, 0x3c, 0x5e])],
	// 4: Forest (Viridian Forest, etc.)
	[4, new Set([0x1e, 0x20, 0x2e, 0x30, 0x34, 0x37, 0x39, 0x3a, 0x40, 0x51, 0x52, 0x5a, 0x5c, 0x5e, 0x5f])],
	// 5: House (generic indoor)
	[5, new Set([0x01, 0x12, 0x14, 0x28, 0x32, 0x37, 0x44, 0x54, 0x5c])],
	// 6: ForestGate / Museum / Gate
	[6, new Set([0x01, 0x12, 0x14, 0x1a, 0x1c, 0x37, 0x38, 0x3b, 0x3c, 0x5e])],
	// 7: Museum (same as ForestGate)
	[7, new Set([0x01, 0x12, 0x14, 0x1a, 0x1c, 0x37, 0x38, 0x3b, 0x3c, 0x5e])],
	// 8: Pokecenter
	[8, new Set([0x11, 0x1a, 0x1c, 0x3c, 0x5e])],
	// 9: Gym
	[9, new Set([0x11, 0x16, 0x19, 0x2b, 0x3c, 0x3d, 0x3f, 0x4a, 0x4c, 0x4d, 0x03])],
	// 10: Ship
	[10, new Set([0x04, 0x0d, 0x17, 0x1d, 0x1e, 0x23, 0x34, 0x37, 0x39, 0x4a])],
	// 11: ShipPort
	[11, new Set([0x0a, 0x1a, 0x32, 0x3b])],
	// 12: Cemetery (Pokemon Tower)
	[12, new Set([0x01, 0x10, 0x13, 0x1b, 0x22, 0x42, 0x52])],
	// 13: Interior
	[13, new Set([0x04, 0x0f, 0x15, 0x1f, 0x3b, 0x45, 0x47, 0x55, 0x56])],
	// 14: Cavern
	[14, new Set([0x05, 0x15, 0x18, 0x1a, 0x20, 0x21, 0x22, 0x2a, 0x2d, 0x30])],
	// 15: Lobby
	[15, new Set([0x14, 0x17, 0x1a, 0x1c, 0x20, 0x38, 0x45])],
	// 16: Mansion
	[16, new Set([0x01, 0x05, 0x11, 0x12, 0x14, 0x1a, 0x1c, 0x2c, 0x53])],
	// 17: Gate (same as ForestGate)
	[17, new Set([0x01, 0x12, 0x14, 0x1a, 0x1c, 0x37, 0x38, 0x3b, 0x3c, 0x5e])],
	// 18: Lab (Prof. Oak's Lab)
	[18, new Set([0x0c, 0x26, 0x16, 0x1e, 0x34, 0x37])],
	// 19: Club (Pokemon Fan Club, etc.)
	[19, new Set([0x0f, 0x1a, 0x1f, 0x26, 0x28, 0x29, 0x2c, 0x2d, 0x2e, 0x2f, 0x41])],
	// 20: Underground
	[20, new Set([0x0b, 0x0c, 0x13, 0x15, 0x18])],
	// 21: Dojo
	[21, new Set([0x11, 0x16, 0x19, 0x2b, 0x3c, 0x3d, 0x3f, 0x4a, 0x4c, 0x4d, 0x03])],
	// 22: Facility (Silph Co, Power Plant, etc.)
	[
		22,
		new Set([
			0x01, 0x10, 0x11, 0x13, 0x1b, 0x20, 0x21, 0x22, 0x30, 0x31, 0x32, 0x42, 0x43, 0x48, 0x52, 0x55, 0x58, 0x5e,
		]),
	],
	// 23: Plateau (Indigo Plateau, Victory Road)
	[23, new Set([0x1b, 0x23, 0x2c, 0x2d, 0x3b, 0x45])],
]);

/**
 * Check if a tile is walkable for the given tileset.
 * Returns true if the tile is in the walkable list, false if it's solid.
 */
export function isTileWalkable(tilesetId: number, tileId: number): boolean {
	const walkable = TILESET_COLLISION.get(tilesetId);
	if (!walkable) {
		// Unknown tileset, assume walkable (conservative)
		return true;
	}
	return walkable.has(tileId);
}

/**
 * Describe what type of obstacle a non-walkable tile likely is,
 * based on common tile patterns per tileset.
 */
// biome-ignore lint/complexity/noExcessiveCognitiveComplexity: tile description with many tileset-specific branches
export function describeTile(tilesetId: number, tileId: number): string {
	const walkable = isTileWalkable(tilesetId, tileId);
	if (walkable) return 'walkable path';

	// Overworld common obstacles
	if (tilesetId === 0) {
		if ([0x03, 0x04, 0x05, 0x06, 0x07].includes(tileId)) return 'tree/hedge';
		if ([0x0d, 0x0e, 0x0f].includes(tileId)) return 'water';
		if ([0x12, 0x13, 0x14, 0x15].includes(tileId)) return 'building wall';
		if ([0x24, 0x25, 0x26, 0x27].includes(tileId)) return 'fence/ledge';
		if ([0x50, 0x51, 0x53].includes(tileId)) return 'sign/rock';
		return 'obstacle';
	}

	// Indoor common obstacles
	if ([1, 2, 5].includes(tilesetId)) {
		if ([0x00, 0x04, 0x05, 0x08].includes(tileId)) return 'wall';
		if ([0x06, 0x07, 0x0a].includes(tileId)) return 'furniture';
		if ([0x15, 0x16, 0x17].includes(tileId)) return 'shelf/counter';
		return 'furniture/wall';
	}

	return 'obstacle';
}
